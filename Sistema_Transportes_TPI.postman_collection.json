{
	"info": {
		"_postman_id": "tpi-transportes-2025-v2",
		"name": "Sistema Transportes TPI - V2 Optimizado",
		"description": "Collection actualizada con workflow completo de rutas optimizadas y gestión de tramos.\n\n## 🚀 Novedades V2\n\n### Optimización de Rutas\n- **90% reducción en llamadas a Google Maps API**\n- Fase 1: Selección con Haversine (matemática)\n- Fase 2: Google Maps solo para ruta final\n\n### Workflow Automático\n1. POST /api/solicitudes → Rutas auto-calculadas en response\n2. Seleccionar estrategia óptima\n3. POST /api/rutas/{id}/asignar → Tramos auto-creados\n4. Gestión completa de tramos (asignar, iniciar, finalizar)\n\n### Umbrales de Distancia\n- 0-500km: DIRECTA\n- 500-1000km: UN_DEPOSITO\n- 1000-1500km: DOS_DEPOSITOS\n- 1500+km: TRES_DEPOSITOS\n\n## 📋 Inicio Rápido\n1. docker-compose up -d\n2. Auth → Login Admin\n3. Workflow Optimizado V2 (ejecutar en orden)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"exec": [
					"const tokenExpiry = pm.collectionVariables.get('token_expiry');",
					"const now = Date.now();",
					"",
					"if (!tokenExpiry || now >= (tokenExpiry - 30000)) {",
					"    pm.sendRequest({",
					"        url: pm.collectionVariables.get('keycloak_url') + '/realms/tpi-realm/protocol/openid-connect/token',",
					"        method: 'POST',",
					"        header: { 'Content-Type': 'application/x-www-form-urlencoded' },",
					"        body: {",
					"            mode: 'urlencoded',",
					"            urlencoded: [",
					"                {key: 'client_id', value: 'tpi-backend'},",
					"                {key: 'grant_type', value: 'password'},",
					"                {key: 'username', value: pm.collectionVariables.get('username') || 'admin'},",
					"                {key: 'password', value: pm.collectionVariables.get('password') || 'admin123'}",
					"            ]",
					"        }",
					"    }, function (err, res) {",
					"        if (!err && res.code === 200) {",
					"            const jsonData = res.json();",
					"            pm.collectionVariables.set('access_token', jsonData.access_token);",
					"            pm.collectionVariables.set('token_expiry', Date.now() + (jsonData.expires_in * 1000));",
					"        }",
					"    });",
					"}"
				],
				"type": "text/javascript"
			}
		}
	],
	"variable": [
		{ "key": "gateway_url", "value": "http://localhost:8080", "type": "string" },
		{ "key": "keycloak_url", "value": "http://localhost:9090", "type": "string" },
		{ "key": "access_token", "value": "", "type": "string" },
		{ "key": "token_expiry", "value": "", "type": "string" },
		{ "key": "username", "value": "admin", "type": "string" },
		{ "key": "password", "value": "admin123", "type": "string" },
		{ "key": "solicitud_id", "value": "", "type": "string" },
		{ "key": "ruta_id", "value": "", "type": "string" },
		{ "key": "tramo_id", "value": "", "type": "string" },
		{ "key": "camion_id", "value": "1", "type": "string" },
		{ "key": "transportista_id", "value": "1", "type": "string" }
	],
	"item": [
		{
			"name": "🔐 1. Autenticación",
			"item": [
				{
					"name": "Login - Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set('access_token', jsonData.access_token);",
									"    pm.collectionVariables.set('token_expiry', Date.now() + (jsonData.expires_in * 1000));",
									"    console.log('✅ Token obtenido (válido por ' + jsonData.expires_in + 's)');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{ "key": "client_id", "value": "tpi-backend" },
								{ "key": "grant_type", "value": "password" },
								{ "key": "username", "value": "admin" },
								{ "key": "password", "value": "admin123" }
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/tpi-realm/protocol/openid-connect/token",
							"host": ["{{keycloak_url}}"],
							"path": ["realms", "tpi-realm", "protocol", "openid-connect", "token"]
						},
						"description": "Obtiene token JWT para usuario Admin"
					}
				}
			]
		},
		{
			"name": "🚀 2. Workflow Optimizado V2",
			"item": [
				{
					"name": "PASO 1 - Crear Solicitud (con Rutas Auto-Calculadas)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201 || pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set('solicitud_id', jsonData.id);",
									"    console.log('✅ PASO 1 COMPLETADO');",
									"    console.log('   Solicitud ID: ' + jsonData.id);",
									"    ",
									"    if (jsonData.rutasTentativas && jsonData.rutasTentativas.length > 0) {",
									"        pm.collectionVariables.set('ruta_id', jsonData.rutasTentativas[0].id);",
									"        console.log('   Rutas calculadas: ' + jsonData.rutasTentativas.length);",
									"        jsonData.rutasTentativas.forEach((ruta, i) => {",
									"            console.log('   Ruta ' + (i+1) + ': ' + ruta.estrategia + ' - ' + ruta.distanciaTotalKm + ' km - $' + ruta.costoEstimado);",
									"            if (ruta.depositosIntermedios && ruta.depositosIntermedios.length > 0) {",
									"                console.log('      Depósitos: ' + ruta.depositosIntermedios.join(', '));",
									"            }",
									"        });",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{ "key": "Content-Type", "value": "application/json" }],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cliente\": {\n    \"nombreCompleto\": \"Juan Pérez Test\",\n    \"email\": \"juan.perez@test.com\",\n    \"telefono\": \"+541145678900\",\n    \"direccion\": \"Av. Corrientes 1234, CABA\"\n  },\n  \"contenedor\": {\n    \"numeroIdentificacion\": \"CONT-TEST-001\",\n    \"pesoKg\": 12000.0,\n    \"volumenM3\": 28.0,\n    \"tipo\": \"ESTANDAR\",\n    \"observaciones\": \"Test workflow optimizado\"\n  },\n  \"origenDireccion\": \"Buenos Aires, Argentina\",\n  \"destinoDireccion\": \"Mendoza, Argentina\"\n}"
						},
						"url": {
							"raw": "{{gateway_url}}/api/solicitudes",
							"host": ["{{gateway_url}}"],
							"path": ["api", "solicitudes"]
						},
						"description": "Crea solicitud y calcula rutas automáticamente. Response incluye rutasTentativas con estrategias DIRECTA y con depósitos."
					}
				},
				{
					"name": "PASO 2 - Ver Rutas de la Solicitud",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var rutas = pm.response.json();",
									"    console.log('✅ PASO 2 COMPLETADO');",
									"    console.log('   Total rutas: ' + rutas.length);",
									"    rutas.forEach((ruta, i) => {",
									"        console.log('   Ruta ' + ruta.id + ': ' + ruta.estado + ' | ' + ruta.estrategia);",
									"        console.log('      ' + ruta.distanciaTotalKm + ' km - $' + ruta.costoEstimado + ' - ' + ruta.cantidadTramos + ' tramos');",
									"        if (ruta.depositosIntermedios && ruta.depositosIntermedios.length > 0) {",
									"            console.log('      Depósitos: ' + ruta.depositosIntermedios.join(', '));",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/solicitudes/{{solicitud_id}}/rutas",
							"host": ["{{gateway_url}}"],
							"path": ["api", "solicitudes", "{{solicitud_id}}", "rutas"]
						},
						"description": "Obtiene todas las rutas (tentativas, asignadas, canceladas) de una solicitud"
					}
				},
				{
					"name": "PASO 3 - Asignar Ruta (Crea Tramos Automáticamente)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var ruta = pm.response.json();",
									"    console.log('✅ PASO 3 COMPLETADO');",
									"    console.log('   Ruta asignada: ' + ruta.id);",
									"    console.log('   Estado: ' + ruta.estado);",
									"    console.log('   Estrategia: ' + ruta.estrategia);",
									"    console.log('   Tramos creados: ' + ruta.cantidadTramos);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/logistica/rutas/{{ruta_id}}/asignar?solicitudId={{solicitud_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "logistica", "rutas", "{{ruta_id}}", "asignar"],
							"query": [
								{ "key": "solicitudId", "value": "{{solicitud_id}}" }
							]
						},
						"description": "Asigna ruta tentativa a solicitud. Cambia ruta a ASIGNADA, otras a CANCELADA, y crea tramos en BD automáticamente."
					}
				},
				{
					"name": "PASO 4 - Ver Tramos Creados",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var tramos = pm.response.json();",
									"    console.log('✅ PASO 4 COMPLETADO');",
									"    console.log('   Total tramos: ' + tramos.length);",
									"    if (tramos.length > 0) {",
									"        pm.collectionVariables.set('tramo_id', tramos[0].id);",
									"    }",
									"    tramos.forEach((tramo, i) => {",
									"        console.log('   Tramo ' + tramo.ordenTramo + ' (ID: ' + tramo.id + '): ' + tramo.estado);",
									"        console.log('      ' + tramo.origenTipo + ' → ' + tramo.destinoTipo + ' | ' + tramo.distanciaKm + ' km');",
									"        if (tramo.origenId) console.log('      Origen Depósito ID: ' + tramo.origenId);",
									"        if (tramo.destinoId) console.log('      Destino Depósito ID: ' + tramo.destinoId);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/logistica/tramos/solicitud/{{solicitud_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "logistica", "tramos", "solicitud", "{{solicitud_id}}"]
						},
						"description": "Lista todos los tramos de la solicitud con información de depósitos (origenId/destinoId)"
					}
				},
				{
					"name": "PASO 5 - Asignar Camión y Transportista al Tramo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var tramo = pm.response.json();",
									"    console.log('✅ PASO 5 COMPLETADO');",
									"    console.log('   Tramo ID: ' + tramo.id);",
									"    console.log('   Estado: ' + tramo.estado);",
									"    console.log('   Camión: ' + tramo.camionId);",
									"    console.log('   Transportista: ' + tramo.transportistaId);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/logistica/tramos/{{tramo_id}}/asignar?camionId={{camion_id}}&transportistaId={{transportista_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "logistica", "tramos", "{{tramo_id}}", "asignar"],
							"query": [
								{ "key": "camionId", "value": "{{camion_id}}" },
								{ "key": "transportistaId", "value": "{{transportista_id}}" }
							]
						},
						"description": "Asigna recursos al tramo. Peso y volumen se obtienen automáticamente del contenedor de la solicitud. Cambia estado a ASIGNADO."
					}
				},
				{
					"name": "PASO 6 - Iniciar Tramo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var tramo = pm.response.json();",
									"    console.log('✅ PASO 6 COMPLETADO');",
									"    console.log('   Tramo ID: ' + tramo.id);",
									"    console.log('   Estado: ' + tramo.estado);",
									"    console.log('   Fecha Inicio: ' + tramo.fechaInicio);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/logistica/tramos/{{tramo_id}}/iniciar",
							"host": ["{{gateway_url}}"],
							"path": ["api", "logistica", "tramos", "{{tramo_id}}", "iniciar"]
						},
						"description": "Inicia tramo. Cambia estado a INICIADO, registra fechaInicio, camión pasa a EN_USO."
					}
				},
				{
					"name": "PASO 7 - Finalizar Tramo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var tramo = pm.response.json();",
									"    console.log('✅ PASO 7 COMPLETADO');",
									"    console.log('   Tramo ID: ' + tramo.id);",
									"    console.log('   Estado: ' + tramo.estado);",
									"    console.log('   Fecha Fin: ' + tramo.fechaFin);",
									"    console.log('   Camión liberado');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/logistica/tramos/{{tramo_id}}/finalizar",
							"host": ["{{gateway_url}}"],
							"path": ["api", "logistica", "tramos", "{{tramo_id}}", "finalizar"]
						},
						"description": "Finaliza tramo. Cambia estado a FINALIZADO, registra fechaFin, libera camión (DISPONIBLE)."
					}
				},
				{
					"name": "PASO 8 - Verificar Estado de Solicitud",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var sol = pm.response.json();",
									"    console.log('✅ PASO 8 COMPLETADO');",
									"    console.log('   Solicitud ID: ' + sol.id);",
									"    console.log('   Estado: ' + sol.estado);",
									"    if (sol.costoReal) {",
									"        console.log('   Costo Real: $' + sol.costoReal);",
									"    }",
									"    if (sol.estado === 'FINALIZADA') {",
									"        console.log('   ✓ Todos los tramos completados');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/solicitudes/{{solicitud_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "solicitudes", "{{solicitud_id}}"]
						},
						"description": "Verifica estado de solicitud. Si todos los tramos están FINALIZADOS, estado será FINALIZADA."
					}
				}
			],
			"description": "Workflow completo optimizado con rutas auto-calculadas y gestión de tramos"
		},
		{
			"name": "📦 3. Gestión de Solicitudes",
			"item": [
				{
					"name": "Listar Solicitudes",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/solicitudes",
							"host": ["{{gateway_url}}"],
							"path": ["api", "solicitudes"]
						}
					}
				},
				{
					"name": "Obtener Solicitud por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/solicitudes/{{solicitud_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "solicitudes", "{{solicitud_id}}"]
						}
					}
				},
				{
					"name": "Obtener Rutas de Solicitud",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/solicitudes/{{solicitud_id}}/rutas",
							"host": ["{{gateway_url}}"],
							"path": ["api", "solicitudes", "{{solicitud_id}}", "rutas"]
						},
						"description": "Endpoint nuevo que retorna todas las rutas (tentativas, asignadas, canceladas) de una solicitud"
					}
				}
			]
		},
		{
			"name": "🚛 4. Gestión de Logística",
			"item": [
				{
					"name": "Rutas",
					"item": [
						{
							"name": "Calcular Rutas Tentativas",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/rutas/tentativas/{{solicitud_id}}",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "rutas", "tentativas", "{{solicitud_id}}"]
								},
								"description": "Recalcula rutas con estrategia optimizada (Haversine + Google Maps). Umbrales: 0-500km DIRECTA, 500-1000km UN_DEPOSITO, 1000-1500km DOS_DEPOSITOS, 1500+km TRES_DEPOSITOS"
							}
						},
						{
							"name": "Asignar Ruta",
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/rutas/{{ruta_id}}/asignar?solicitudId={{solicitud_id}}",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "rutas", "{{ruta_id}}", "asignar"],
									"query": [
										{ "key": "solicitudId", "value": "{{solicitud_id}}" }
									]
								},
								"description": "Asigna ruta, cambia estado a ASIGNADA, cancela otras rutas, crea tramos automáticamente"
							}
						}
					]
				},
				{
					"name": "Tramos",
					"item": [
						{
							"name": "Listar Tramos de Solicitud",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/tramos/solicitud/{{solicitud_id}}",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "tramos", "solicitud", "{{solicitud_id}}"]
								},
								"description": "Lista tramos con información de depósitos (origenId/destinoId cuando tipo=DEPOSITO)"
							}
						},
						{
							"name": "Asignar Recursos a Tramo",
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/tramos/{{tramo_id}}/asignar?camionId={{camion_id}}&transportistaId={{transportista_id}}",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "tramos", "{{tramo_id}}", "asignar"],
									"query": [
										{ "key": "camionId", "value": "{{camion_id}}" },
										{ "key": "transportistaId", "value": "{{transportista_id}}" }
									]
								},
								"description": "Asigna camión y transportista. Peso y volumen se obtienen del contenedor automáticamente. Estado: PENDIENTE → ASIGNADO"
							}
						},
						{
							"name": "Iniciar Tramo",
							"request": {
								"method": "PATCH",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/tramos/{{tramo_id}}/iniciar",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "tramos", "{{tramo_id}}", "iniciar"]
								},
								"description": "Inicia tramo. Estado: ASIGNADO → INICIADO. Registra fechaInicio, camión EN_USO"
							}
						},
						{
							"name": "Finalizar Tramo",
							"request": {
								"method": "PATCH",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/tramos/{{tramo_id}}/finalizar",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "tramos", "{{tramo_id}}", "finalizar"]
								},
								"description": "Finaliza tramo. Estado: INICIADO → FINALIZADO. Registra fechaFin, libera camión"
							}
						}
					]
				},
				{
					"name": "Recursos",
					"item": [
						{
							"name": "Listar Camiones",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/camiones",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "camiones"]
								}
							}
						},
						{
							"name": "Listar Transportistas",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/transportistas",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "transportistas"]
								}
							}
						},
						{
							"name": "Listar Depósitos",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/logistica/depositos",
									"host": ["{{gateway_url}}"],
									"path": ["api", "logistica", "depositos"]
								}
							}
						}
					]
				}
			]
		},
		{
			"name": "📍 5. Tracking",
			"item": [
				{
					"name": "Listar Eventos de Solicitud",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/tracking/eventos/solicitud/{{solicitud_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "tracking", "eventos", "solicitud", "{{solicitud_id}}"]
						}
					}
				},
				{
					"name": "Listar Eventos de Tramo",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/api/tracking/eventos/tramo/{{tramo_id}}",
							"host": ["{{gateway_url}}"],
							"path": ["api", "tracking", "eventos", "tramo", "{{tramo_id}}"]
						}
					}
				},
				{
					"name": "Registrar Evento",
					"request": {
						"method": "POST",
						"header": [{ "key": "Content-Type", "value": "application/json" }],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"solicitudId\": {{solicitud_id}},\n  \"tramoId\": {{tramo_id}},\n  \"tipoEvento\": \"EN_TRANSITO\",\n  \"descripcion\": \"Camión en ruta\",\n  \"lat\": -34.6037,\n  \"lon\": -58.3816\n}"
						},
						"url": {
							"raw": "{{gateway_url}}/api/tracking/eventos/registrar",
							"host": ["{{gateway_url}}"],
							"path": ["api", "tracking", "eventos", "registrar"]
						}
					}
				}
			]
		},
		{
			"name": "💰 6. Facturación",
			"item": [
				{
					"name": "Tarifas",
					"item": [
						{
							"name": "Obtener Tarifa Vigente",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/tarifas/vigente",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "tarifas", "vigente"]
								},
								"description": "Retorna la tarifa actualmente vigente con todos los valores de cargo."
							}
						},
						{
							"name": "Listar Todas las Tarifas",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/tarifas",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "tarifas"]
								}
							}
						}
					]
				},
				{
					"name": "Facturas",
					"item": [
						{
							"name": "Generar Factura (Automático)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {",
											"    const response = pm.response.json();",
											"    pm.collectionVariables.set('factura_id', response.id);",
											"    console.log('✅ Factura generada: ID =', response.id);",
											"    console.log('💵 Total:', response.total);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/facturas/generar?solicitudId={{solicitud_id}}",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "facturas", "generar"],
									"query": [
										{
											"key": "solicitudId",
											"value": "{{solicitud_id}}"
										}
									]
								},
								"description": "Genera la factura consultando automáticamente los tramos desde ms-logistica.\n\n**Fórmula:**\n- Cargo Gestión = Base + (cantidad_tramos × cargo_por_tramo)\n- Costo Transporte = Σ(distancia × costo_km_camion)\n- Costo Combustible = Σ(distancia × consumo_camion × precio_litro)\n- Estadías = Σ(días × costo_depósito)\n- Impuestos = Subtotal × 21%"
							}
						},
						{
							"name": "Obtener Factura por Solicitud",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/facturas/solicitud/{{solicitud_id}}",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "facturas", "solicitud", "{{solicitud_id}}"]
								},
								"description": "Consulta la factura asociada a una solicitud específica."
							}
						},
						{
							"name": "Listar Todas las Facturas",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/facturas",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "facturas"]
								}
							}
						}
					]
				},
				{
					"name": "Estadías en Depósito",
					"item": [
						{
							"name": "Registrar Entrada a Depósito",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"if (pm.response.code === 200) {",
											"    const response = pm.response.json();",
											"    pm.collectionVariables.set('estadia_id', response.id);",
											"    console.log('✅ Entrada registrada: Estadía ID =', response.id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"contenedorId\": 1,\n  \"depositoId\": 5,\n  \"costoDia\": 3000.0,\n  \"observaciones\": \"Entrada por optimización de ruta\"\n}"
								},
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/estadias/registrar-entrada",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "estadias", "registrar-entrada"]
								},
								"description": "Registra cuando un contenedor ingresa a un depósito. Inicia el cómputo de estadía."
							}
						},
						{
							"name": "Registrar Salida de Depósito",
							"request": {
								"method": "POST",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/estadias/{{estadia_id}}/registrar-salida",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "estadias", "{{estadia_id}}", "registrar-salida"]
								},
								"description": "Registra la salida del contenedor. Calcula automáticamente:\n- días_estadia = diferencia en días\n- costo_total = días × costo_dia"
							}
						},
						{
							"name": "Listar Estadías por Contenedor",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/estadias/contenedor/1",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "estadias", "contenedor", "1"]
								}
							}
						},
						{
							"name": "Listar Todas las Estadías",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/api/facturacion/estadias",
									"host": ["{{gateway_url}}"],
									"path": ["api", "facturacion", "estadias"]
								}
							}
						}
					]
				}
			]
		}
	]
}
